#!/usr/bin/env sh
#-*- mode: shell-script -*-

SUBDIR=$(gpgconf --list-dirs socketdir \
       | sed -E 's/^\/run\/user\/[[:digit:]]*\/gnupg(\/d\.[[:alnum:]]*)$/\1/')

for f in $(ls ${XDG_CONFIG_HOME}/systemd/user/*.m4\
              ${XDG_CONFIG_HOME}/environment.d/*.m4)
do
    m4 -D GPGSOCKETSUBDIR="${SUBDIR}" ${f} > ${f%.m4}
done
